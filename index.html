<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>PUSH-уведомления</title>
        <link rel="stylesheet" href="styles.css">

        <!-- PUSH SDK -->
        <!--
        <script type="text/javascript" src="ak-push.js"></script>
        <link rel="manifest" href="manifest.json">
        -->
    </head>

    <body>
        <h2>
            <p>Pixel for event merge testing:</p>
            <!-- START OF ALTCRAFT PIXEL CODE !-->
            <a href="https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com/pixel?k=34FyFph%2BVuzFYrhPh7C10IJo%2Br4EkbuWm%2Fqui6fGQJa6XD9SM9jghQ%3D%3D&s=OVA7pk7G%2FmI%3D&redirect_url=&goals=&value=0">Click!</a>
            <!-- END OF ALTCRAFT PIXEL CODE !-->
        </h2>

        <!-- <script src=https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com/form/js/embed_v1.js></script>
        <iframe src="https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com/form?form=81Ge8LwsdLQMui5adPSEuvfGkukwWpjWfwqCzX5obA4zLaR9sQTKEnwoaVEZr4GuBNU6C6RxrR51M9faAzCPXgEa&iframe=1" frameborder="0" name="ak-form-81Ge8LwsdLQMui5adPSEuvfGkukwWpjWfwqCzX5obA4zLaR9sQTKEnwoaVEZr4GuBNU6C6RxrR51M9faAzCPXgEa" class="ak-form" width="100%" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox allow-top-navigation"></iframe> -->

        <div class="UpdateData">
            <input type="text" id="emailInput" placeholder="test@qa.altcraft.com">email для матчинга<br>
            <input type="text" id="db_id" placeholder="1">id базы профилей<br>
            <input type="text" id="fname" placeholder="Cool">текст для обновления _fname<br>
            <input type="text" id="lname" placeholder="Tester">текст для обновления _lname<br>
        </div>

        <div class="Subscribe-container">
            <p>Subscribe:</p>
            <button type="button" id="init_sub">PUSH - подписка</button>
            <script>    
                document.getElementById('init_sub').addEventListener('click', function() {

                    push = new AKPush();

                    const email = (document.getElementById('emailInput').value.trim() == "") ? 'test@qa.altcraft.com': document.getElementById('emailInput').value.trim()  
                    
                    console.log(email)
                    
                    const fname = (document.getElementById('fname').value.trim() == "") ? "Cool" : document.getElementById('fname').value.trim()
                    const lname = (document.getElementById('lname').value.trim() == "") ? "Tester" : document.getElementById('lname').value.trim()

                    // определяем id базы для записи. Пытаемся преобразовать в массив чисел. Если ничего не передано, подставляем числовой литерал `1`
                    const db_id = (document.getElementById('db_id').value != "" ? document.getElementById('db_id').value.split(',').map(Number) : 1)

                    push.initSubscription(
                        { 
                            db: db_id,
                            email: email
                        },
                        {
                            _fname: fname,
                            _lname: lname
                        }
                    )
                });
            </script>
        </div>

        <div class="UpdateSub-container">
            <p>Update subscribe:</p>
            <input type="checkbox" id="inexclusive">inexclusive<br>
            <button type="button" id="update_sub">Обновление подписки</button>
            <script>    
                document.getElementById('update_sub').addEventListener('click', function() {
                    const email = (document.getElementById('emailInput').value.trim() == "") ? 'test@qa.altcraft.com': document.getElementById('emailInput').value.trim()  
                    
                    window.email = email
                    console.log(window.email)
                    
                    const fname = (document.getElementById('fname').value.trim() == "") ? "Cool" : document.getElementById('fname').value.trim()
                    const lname = (document.getElementById('lname').value.trim() == "") ? "Tester" : document.getElementById('lname').value.trim()

                    // определяем id базы для записи. Пытаемся преобразовать в массив чисел. Если ничего не передано, подставляем числовой литерал `1`
                    const db_id = (document.getElementById('db_id').value != "" ? document.getElementById('db_id').value.split(',').map(Number) : 1)
                    
                    const inexclusive = document.getElementById('inexclusive').checked

                    console.log(">>> inexclusive state is - " + inexclusive)
                    push.updateSubscription(
                        { 
                            db: db_id,
                            email: window.email
                        },
                        {
                            _fname: fname,
                            _lname: lname
                        }, 
                        {
                            inexclusive: inexclusive // нужно ли приостанавливать все подписки на ресурс с текущим токеном браузера у остальных профилей
                        }
                    )
                });
            </script>
        </div>

        <div class="Unsubscribe-container">
            <p>Unsubscribe</p>
            <button type="button" id="init_suspend">Приостановить подписку</button>
            <script>    
                document.getElementById('init_suspend').addEventListener('click', function() {
                    const email = (document.getElementById('emailInput').value.trim() == "") ? 'test@qa.altcraft.com': document.getElementById('emailInput').value.trim()  
                    
                    window.email = email
                    console.log(window.email)
                    
                    const fname = (document.getElementById('fname').value.trim() == "") ? "Cool" : document.getElementById('fname').value.trim()
                    const lname = (document.getElementById('lname').value.trim() == "") ? "Tester" : document.getElementById('lname').value.trim()

                    // определяем id базы для записи. Пытаемся преобразовать в массив чисел. Если ничего не передано, подставляем числовой литерал `1`
                    const db_id = (document.getElementById('db_id').value != "" ? document.getElementById('db_id').value.split(',').map(Number) : 1)
                    
                    push.suspendSubscription(
                        { 
                            db: db_id,
                            email: email,
                        }
                        ,
                        {
                            _fname: fname,
                            _lname: lname
                        }
                    )
                });
            </script>
        </div>

        <div class="RemoveToken-container">
            <p>Remove token from browser localforage</p>
            <button type="button" id="remove_token">remove_token</button>
            <script>
                document.getElementById('remove_token').addEventListener('click', function() {
                    push.removeToken() // сбросить токен
                });
            </script>
        </div>

        <div class="PermissonData-container">
            <button type="button" id="permission_status">Permissons status to log</button>
            <script>
                document.getElementById('permission_status').addEventListener('click', function() {
                    const websitePushID = "web.com.altcraft.qa.webpush-et5eeghie0lae7ma";
                    
                    console.log("=== Push Notification Permissions ===");

                    console.log("Notification.permission:", Notification.permission);
                    
                    if ('safari' in window && 'pushNotification' in window.safari) {
                        const permissionData = window.safari.pushNotification.permission(websitePushID);
                        console.log("safari.pushNotification.permission:");
                        console.log("  permission:", permissionData.permission);
                        console.log("  deviceToken:", permissionData.deviceToken || "No token available");
                        console.log("  reason:", permissionData.reason || "No reason provided");
                    }
                });
            </script>
        </div>

        <div class="Popup-container">
            <button type="button" id="popup_open">Open</button>

            <script>

            // window.navigator.sendBeacon = null;
            // window.XMLHttpRequest = null;
                
             (function (popupFunc) {
                    var script = document.createElement('script');
                    var firstScript = document.getElementsByTagName('script')[0];
                    var popupFuncName = popupFunc !== 'acpopup' ? '?f=' + popupFunc : '';
                    window[popupFunc] = window[popupFunc] || function () {
                        (window[popupFunc].actions = window[popupFunc].actions || []).push(arguments);
                    };
                    window[popupFunc].last_init = 1 * new Date()
                    script.async = true;
                    script.src = 'https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com' + '/popup/v1/js/popupLibrary.js' + popupFuncName;
                    firstScript.parentNode.insertBefore(script, firstScript);
             })('acpopup');
        
            </script>
    
            <script>
                document.getElementById('popup_open').addEventListener('click', function() {
                  acpopup('create', 'AP-5SzidM9c3xvlTQFLv');
                  acpopup('show', 'AP-5SzidM9c3xvlTQFLv');
                });
            </script>
        </div>
        
        <script src=https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com/form/js/embed_v1.js></script>
        <iframe src="https://pxl-s5p6zt7kk54afzuh.dev.altcraft.com/form?form=aoq3pd4s1AKh114oS1bVL7CEuKiwRUmiGfYZbsZYyn62yqRGjHeTuxiom7g19Yhic22iQTis65BnF&iframe=1" frameborder="0" name="ak-form-aoq3pd4s1AKh114oS1bVL7CEuKiwRUmiGfYZbsZYyn62yqRGjHeTuxiom7g19Yhic22iQTis65BnF" class="ak-form" width="100%" sandbox="allow-same-origin allow-forms allow-scripts allow-popups allow-popups-to-escape-sandbox allow-top-navigation"></iframe>
    </body>

</html>
